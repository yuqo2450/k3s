---
{% if 'k3s-server' in group_names %}
cluster-init: true
https-listen-port: {{ https_port }}
{% if flannel_backend in ['none', 'vxlan', 'ipsec', 'host-gw', 'wireguard-native']%}
flannel-backend: {{ flannel_backend }}
{% else %}
flannel-backend: vxlan
{% endif %}
{% for val in ['scheduler', 'cloud-controller', 'kube-proxy', 'network-policy', 'helm-controller'] %}
{% if val in disable_components %}
disable-{{ val }}: true
{% else %}
disable-{{ val }}: false
{% endif %}
{% endfor %}
{% if disable_addons | length is gt 0 %}
disable:
{% for val in disable_addons %}
  - {{ val }}
{% endfor %}
{% endif %}
{% if not server in groups['k3s-server'] %}
tls-san: {{ server }}
{% endif %}
{% endif %}
